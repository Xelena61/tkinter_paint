<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Рисовалка</title>
    <style>
        body {
            margin: 0;
            background: #f0f0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            height: 100vh;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        }

        .toolbar {
            margin: 10px 0;
            padding: 8px 12px;
            background: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .toolbar label {
            font-size: 14px;
        }

        .toolbar input[type="color"] {
            width: 40px;
            height: 30px;
            padding: 0;
            border: none;
            background: none;
            cursor: pointer;
        }

        .toolbar input[type="range"] {
            cursor: pointer;
        }

        .toolbar button {
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .toolbar button#clear {
            background: #f3f3f3;
        }

        .toolbar button#save {
            background: #4caf50;
            color: #fff;
        }

        canvas {
            border: 2px solid #666;
            background: #fff;
            cursor: crosshair;
            max-width: 100%;
        }
    </style>
</head>
<body>

<div class="toolbar">
    <label>
        Цвет:
        <input type="color" id="colorPicker" value="#000000">
    </label>

    <label>
        Толщина:
        <input type="range" id="brushSize" min="1" max="40" value="4">
        <span id="brushSizeLabel">4 px</span>
    </label>
     
    <label>
        Инструмент:
        <select id="tool">
            <option value="pencil">Карандаш</option>
            <option value="marker">Маркер</option>
            <option value="calligraphy">Каллиграфическая</option>
            <option value="spray">Аэрограф</option>
            <option value="eraser">Ластик</option>

        </select>
    </label>

    <button id="clear">Очистить</button>
    <button id="save">Сохранить PNG</button>
</div>

<canvas id="paint" width="900" height="550"></canvas>

<script>
    const canvas = document.getElementById("paint");
    const ctx = canvas.getContext("2d");

    const colorPicker = document.getElementById("colorPicker");
    const brushSize = document.getElementById("brushSize");
    const brushSizeLabel = document.getElementById("brushSizeLabel");
    const clearBtn = document.getElementById("clear");
    const saveBtn = document.getElementById("save");
    const toolSelect = document.getElementById("tool");

    let drawing = false;

    // Белый фон, чтобы PNG был не прозрачным
    function fillWhiteBackground() {
        ctx.save();
        ctx.setTransform(1, 0, 0, 1, 0, 0);
        ctx.fillStyle = "#ffffff";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.restore();
    }

    fillWhiteBackground();

    function getCanvasPos(evt) {
        const rect = canvas.getBoundingClientRect();
        if (evt.touches && evt.touches[0]) {
            return {
                x: evt.touches[0].clientX - rect.left,
                y: evt.touches[0].clientY - rect.top
            };
        } else {
            return {
                x: evt.offsetX,
                y: evt.offsetY
            };
        }
    }

    function startDrawing(e) {
        drawing = true;
        const pos = getCanvasPos(e);
        ctx.beginPath();
        ctx.moveTo(pos.x, pos.y);
    }

 function draw(e) {
    if (!drawing) return;

    const pos = getCanvasPos(e);
    const size = Number(brushSize.value);
    const tool = toolSelect.value;

    ctx.strokeStyle = colorPicker.value;
    ctx.fillStyle = colorPicker.value;

    // настройки по умолчанию
    ctx.globalAlpha = 1;
    ctx.lineCap = "round";
    ctx.lineJoin = "round";

    // АЭРОГРАФ — много точек вокруг курсора
    if (tool === "spray") {
        const dots = 25; // количество точек за одно движение
        for (let i = 0; i < dots; i++) {
            const angle = Math.random() * 2 * Math.PI;
            const radius = Math.random() * size;
            const x = pos.x + Math.cos(angle) * radius;
            const y = pos.y + Math.sin(angle) * radius;

            ctx.beginPath();
            ctx.arc(x, y, size / 8, 0, Math.PI * 2);
            ctx.fill();
        }
        return; // для спрея линию дальше не рисуем
    }

    // Настройки для разных кистей
    switch (tool) {
        case "pencil": // обычный карандаш
            ctx.globalAlpha = 1;
            ctx.lineWidth = size;
            ctx.lineCap = "round";
            ctx.lineJoin = "round";
            break;

        case "marker": // толстый полупрозрачный маркер
            ctx.globalAlpha = 0.4;
            ctx.lineWidth = size * 2;
            ctx.lineCap = "round";
            ctx.lineJoin = "round";
            break;

        case "calligraphy": // каллиграфическая кисть
            ctx.globalAlpha = 1;
            ctx.lineWidth = size;
            ctx.lineCap = "butt";
            ctx.lineJoin = "miter";
            break;
    }

    ctx.lineTo(pos.x, pos.y);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(pos.x, pos.y);
}


    // События мыши
    canvas.addEventListener("mousedown", startDrawing);
    canvas.addEventListener("mouseup", stopDrawing);
    canvas.addEventListener("mouseleave", stopDrawing);
    canvas.addEventListener("mousemove", draw);

    // События касаний (для телефона/планшета)
    canvas.addEventListener("touchstart", (e) => {
        e.preventDefault();
        startDrawing(e);
    }, { passive: false });

    canvas.addEventListener("touchend", (e) => {
        e.preventDefault();
        stopDrawing();
    }, { passive: false });

    canvas.addEventListener("touchcancel", (e) => {
        e.preventDefault();
        stopDrawing();
    }, { passive: false });

    canvas.addEventListener("touchmove", (e) => {
        e.preventDefault();
        draw(e);
    }, { passive: false });

    // Обновление подписи толщины
    brushSize.addEventListener("input", () => {
        brushSizeLabel.textContent = brushSize.value + " px";
    });

    // Очистка холста
    clearBtn.addEventListener("click", () => {
        fillWhiteBackground();
    });

    // Сохранение в PNG
    saveBtn.addEventListener("click", () => {
        const link = document.createElement("a");
        link.href = canvas.toDataURL("image/png");
        link.download = "my_drawing.png";
        link.click();
    });
</script>

</body>
</html>

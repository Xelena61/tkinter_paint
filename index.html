<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Рисовалка</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #f0f0f0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            display: flex;
            flex-direction: column;
            aling-items: center;
        }

        .toolbar {
            margin-bottom: 10px;
        }

        canvas {
            border: 1px solid #666;
            background: #ffffff;
        }
    </style>
</head>
    <body>
        <div class="toolbar">
            <label>
                Цвет:
                <input type="color" id="colorPicker" value="#000000">
            </label>
            <label>
                Толщина:
                <input type="range" id="brushSize" min="1" max="40" value="4">
                <span id="brushSizeLabel">4 px</span>
            </label>

            <label>
                Инструменты:
                <select id="tool">
                    <option value="pensil">Карандаш</option>
                    <option value="marker">Маркер</option>
                    <option value="calligraphy">Каллиграфия</option>
                    <option value="spray">Аэрограф</option>
                    <option value="erase">Ластик</option>
                </select>
            </label>
            <button id="clear">Очистить</button>
            <button id="save">Сохранить PNG</button>
        </div>

        <canvas id="paint" width="400" height="200"></canvas>
       <script>
    const canvas = document.getElementById("paint");
    const ctx = canvas.getContext("2d");

    const colorPicker = document.getElementById("colorPicker");
    const brushSize = document.getElementById("brushSize");
    const brushSizeLabel = document.getElementById("brushSizeLabel");
    const toolSelect = document.getElementById("tool");
    const clearBtn = document.getElementById("clear");
    const saveBtn = document.getElementById("save");

    let drawing = false;

    // Белый фон, чтобы PNG не был прозрачным
    function initCanvas() {
        ctx.fillStyle = "#ffffff";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
    }

    initCanvas();

    // Подпись толщины
    brushSizeLabel.textContent = brushSize.value + " px";

    brushSize.addEventListener("input", () => {
        brushSizeLabel.textContent = brushSize.value + " px";
    });

    // Координаты курсора на холсте — БЕЗ смещения
    function getCanvasPos(e) {
        return {
            x: e.offsetX,
            y: e.offsetY
        };
    }

    // Настройки для разных инструментов
    function applyToolSettings() {
        const size = Number(brushSize.value);

        ctx.lineJoin = "round";
        ctx.globalAlpha = 1.0;

        switch (toolSelect.value) {
            case "pencil":      // Карандаш
                ctx.lineWidth = size;
                ctx.lineCap = "round";
                ctx.strokeStyle = colorPicker.value;
                break;

            case "marker":      // Маркер (толще и полупрозрачный)
                ctx.globalAlpha = 0.4;
                ctx.lineWidth = size * 2;
                ctx.lineCap = "round";
                ctx.strokeStyle = colorPicker.value;
                break;

            case "calligraphy": // Каллиграфическая кисть
                ctx.lineWidth = size;
                ctx.strokeStyle = colorPicker.value;
                ctx.lineCap = "butt";
                ctx.lineJoin = "miter";
                break;

            case "erase":       // Ластик — рисуем цветом фона
                ctx.lineWidth = size * 2;
                ctx.lineCap = "round";
                ctx.strokeStyle = "#ffffff";
                break;
        }
    }

    // Начали рисовать
    function startDrawing(e) {
        drawing = true;
        const pos = getCanvasPos(e);
        ctx.beginPath();
        ctx.moveTo(pos.x, pos.y);
    }

    // Перестали рисовать
    function stopDrawing() {
        drawing = false;
        ctx.beginPath();
    }

    // Рисование при движении мыши
    function draw(e) {
        if (!drawing) return;

        const pos = getCanvasPos(e);

        // Аэрограф — отдельная логика
        if (toolSelect.value === "spray") {
            const size = Number(brushSize.value);
            const radius = size;
            const dots = 25;

            ctx.fillStyle = colorPicker.value;

            for (let i = 0; i < dots; i++) {
                const angle = Math.random() * Math.PI * 2;
                const r = Math.random() * radius;
                const x = pos.x + Math.cos(angle) * r;
                const y = pos.y + Math.sin(angle) * r;
                ctx.fillRect(x, y, 1, 1);
            }
            return;
        }

        // Остальные инструменты — линии
        applyToolSettings();

        ctx.lineTo(pos.x, pos.y);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(pos.x, pos.y);
    }

    // События мыши
    canvas.addEventListener("mousedown", startDrawing);
    canvas.addEventListener("mouseup", stopDrawing);
    canvas.addEventListener("mouseleave", stopDrawing);
    canvas.addEventListener("mousemove", draw);

    // Очистить холст
    clearBtn.addEventListener("click", () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        initCanvas();
    });

    // Сохранить в PNG
    saveBtn.addEventListener("click", () => {
        const link = document.createElement("a");
        link.href = canvas.toDataURL("image/png");
        link.download = "my_drawing.png";
        link.click();
    });
</script>

    </body>
    </html>
